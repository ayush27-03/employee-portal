<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Profile - Employee Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/components.css">
</head>

<body>
    <!-- Navigation -->
    <?php include 'includes/navbar.php'; ?>

    <!-- Main Content -->
    <main style="padding: var(--space-8) 0; min-height: calc(100vh - 80px);">
        <div class="container">
            <!-- Page Header -->
            <div style="margin-bottom: var(--space-8);">
                <div
                    style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-4);">
                    <div>
                        <h1 style="margin-bottom: var(--space-2);">My Profile</h1>
                        <p style="color: var(--gray-600);">
                            Manage your personal information and account settings.
                        </p>
                    </div>
                    <a href="dashboard.php" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i>
                        Back to Dashboard
                    </a>
                </div>
            </div>

            <!-- Profile Content -->
            <div class="grid grid-cols-3 gap-8">
                <!-- Profile Information Card -->
                <div class="card" style="grid-column: span 2;">
                    <div class="card-header">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-user-edit"></i>
                            Personal Information
                        </h3>
                    </div>
                    <div class="card-body">
                        <!-- Success/Error message -->
                        <!-- PHP: Add your success/error message display here -->
                        <?php
                        require_once 'includes/config.php';
                        $password_change_success = false;
                        $error_message = '';

                        //@ Personal Info Change Functionality
                        $id = $_SESSION['eid'];
                        $stmt = $conn->prepare("SELECT email FROM employee WHERE id = :id");
                        $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                        $stmt->execute();
                        $storedEmailFromDB = $stmt->fetch(PDO::FETCH_ASSOC);

                        if (!isset($_SESSION['email'])) {
                            $_SESSION['email'] = $storedEmailFromDB['email'];
                        }
                        $currMail = $_SESSION['email'] ?? '';

                        if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['update_profile'])) {
                            $newEmail = trim($_POST['email'] ?? '');
                            $newFirstName = trim($_POST['first_name'] ?? '');
                            $newLastName = trim($_POST['last_name'] ?? '');

                            $stmt1 = $conn->prepare("UPDATE employee SET email = :email, first_name = :first_name, last_name = :last_name WHERE id = :id");
                            $stmt1->bindParam(':email', $newEmail, PDO::PARAM_STR);
                            $stmt1->bindParam(':first_name', $newFirstName, PDO::PARAM_STR);
                            $stmt1->bindParam(':last_name', $newLastName, PDO::PARAM_STR);
                            $stmt1->bindParam(':id', $id, PDO::PARAM_INT);
                            $stmt1->execute();

                            $messages = [];

                            if (!empty($newEmail) && $newEmail !== $_SESSION['email']) {
                                $storedEmailFromDB = $newEmail;
                                $_SESSION['email'] = $newEmail;
                                $messages[] = "Email updated successfully to: $newEmail";
                            }

                            if (!empty($newFirstName) && $newFirstName !== $_SESSION['firstName']) {
                                $_SESSION['firstName'] = $newFirstName;
                                $messages[] = "First name updated to: $newFirstName";
                            }

                            if (!empty($newLastName) && $newLastName !== $_SESSION['lastName']) {
                                $_SESSION['lastName'] = $newLastName;
                                $messages[] = "Last name updated to: $newLastName";
                            }
                            if (!empty($messages)) {
                                $message = implode('<br>', $messages);  // Concatenate for display
                            } else {
                                $message = "No changes were made.";
                            }
                            $currMail = $_SESSION['email'];
                            $first_name = $_SESSION['firstName'];
                            $last_name = $_SESSION['lastName'];
                        }
                        ?>

                        <?php if (!empty($message))
                            // echo "<div class='msg'>$message</div>";
                            echo "<script>alert(" . json_encode($message) . ");</script>";
                        ?>

                        <form action="<?php echo htmlspecialchars($_SERVER['PHP_SELF']); ?>" method="post"
                            class="profile-form">
                            <div class="grid grid-cols-2 gap-6">
                                <div class="form-group">
                                    <label for="first_name" class="first_name">
                                        <i class="fas fa-user"></i> First Name
                                    </label>
                                    <input type="text" id="first_name" name="first_name" class="form-input"
                                        placeholder="Enter first name" value="<?= $_SESSION['firstName'] ?>" required />
                                </div>

                                <div class="form-group">
                                    <label for="last_name" class="last_name">
                                        <i class="fas fa-user"></i> Last Name
                                    </label>
                                    <input type="text" id="last_name" name="last_name" class="form-input"
                                        placeholder="Enter last name" value="<?= $_SESSION['lastName'] ?>" required />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email" class="email">
                                    <i class="fas fa-envelope"></i> Email Address
                                </label>
                                <input class="form-input" type="email" id="email" name="email"
                                    value="<?= htmlspecialchars($currMail) ?>" />
                                <small>You can change your email and submit again.</small>
                            </div>

                            <div style="display: flex; gap: var(--space-4); margin-top: var(--space-6);">
                                <button type="submit" name="update_profile" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Update Profile
                                </button>
                                <button type="reset" class="btn btn-secondary">
                                    <i class="fas fa-undo"></i>
                                    Reset Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Profile Summary Card -->
                <div class="card">
                    <div class="card-header">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-id-card"></i>
                            Profile Summary
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="text-align: center; margin-bottom: var(--space-6);">
                            <div
                                style="width: 80px; height: 80px; background: var(--primary-100); color: var(--primary-600); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: var(--text-2xl); margin: 0 auto var(--space-4);">
                                <!-- PHP: Display user initials here -->
                                <?php echo strtoupper(substr(ucfirst($_SESSION['firstName']) ?? 'U', 0, 1) . substr(ucfirst($_SESSION['lastName']) ?? 'N', 0, 1)); ?>
                            </div>
                            <h4 style="margin-bottom: var(--space-1);">
                                <?= htmlspecialchars($_SESSION['firstName'] ?? '') . ' ' . (ucfirst($_SESSION['lastName']) ?? '') ?>
                            </h4>
                            <p style="color: var(--gray-500); margin: 0; font-size: var(--text-sm);">
                                @<?= htmlspecialchars($_SESSION['username']) ?>
                            </p>
                        </div>

                        <div style="space-y: var(--space-3);">
                            <div
                                style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--gray-200);">
                                <span style="color: var(--gray-600); font-size: var(--text-sm);">Employee</span>
                                <span
                                    style="font-weight: 500; font-size: var(--text-sm); font-family: var(--font-family-mono);">
                                    <!-- PHP: Display formatted employee ID here -->
                                    #<?php echo str_pad($_SESSION['eid'] ?? '0', 4, '0', STR_PAD_LEFT); ?>
                                </span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--gray-200);">
                                <span style="color: var(--gray-600); font-size: var(--text-sm);">Role</span>
                                <span
                                    style="font-weight: 500; font-size: var(--text-sm); font-family: var(--font-family-mono);">
                                    <!-- PHP: Display formatted employee ID here -->
                                    <?php echo ucfirst($_SESSION['rname']) ?>
                                </span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; padding: var(--space-2) 0; border-bottom: 1px solid var(--gray-200);">
                                <span style="color: var(--gray-600); font-size: var(--text-sm);">Department</span>
                                <span
                                    style="font-weight: 500; font-size: var(--text-sm); font-family: var(--font-family-mono);">
                                    <!-- PHP: Display formatted employee ID here -->
                                    <?php echo ucfirst($_SESSION['dname']) ?>
                                </span>
                            </div>

                            <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0;">
                                <span style="color: var(--gray-600); font-size: var(--text-sm);">Member Since</span>
                                <span
                                    style="font-weight: 500; font-size: var(--text-sm); font-family: var(--font-family-mono);">
                                    <!-- PHP: Display registration date here -->
                                    <?= htmlspecialchars(date("d M Y", strtotime($_SESSION['dbDate']))) ?>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Details Change Section -->
            <div style="margin-top: var(--space-8);">
                <div class="card">
                    <div class="card-header">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-address-book"></i>
                            Other Details
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="max-width: 800px;">
                            <form action="" method="post" class="details-change-form">
                                <div class="grid grid-cols-3 gap-3">
                                    <div class="form-group">
                                        <label for="phone" class="form-label">
                                            <i class="fas fa-phone"></i> Phone Number
                                        </label>
                                        <input type="tel" id="phone" name="phone" class="form-input"
                                            placeholder="Enter phone number" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name" class="form-label">
                                            <i class="fas fa-city"></i> City
                                        </label>
                                        <input type="text" id="last_name" name="last_name" class="form-input"
                                            placeholder="Enter Nationality" value="" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="bdate" class="form-label">
                                            <i class="fas fa-map-marker-alt"></i> ZIP
                                        </label>
                                        <input type="zip" class="form-input" placeholder="Enter Area ZIP Code"
                                            name="zip" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="State/UT" class="form-label">
                                            <i class="fas fa-map"></i> State/UT
                                        </label>
                                        <input type="dropdown" id="stateut" name="stateut" class="form-input"
                                            placeholder="Select State/UT" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name" class="form-label">
                                            <i class="fas fa-earth-americas"></i> Country
                                        </label>
                                        <input type="text" id="last_name" name="last_name" class="form-input"
                                            placeholder="Enter Nationality" value="" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="PAN" class="form-label">
                                            <i class="fas fa-circle-user"></i> PAN
                                        </label>
                                        <input type="alphanumeric" id="PAN" name="PAN" class="form-input"
                                            placeholder="Enter PAN" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="aadhar" class="form-label">
                                            <i class="fas fa-id-badge"></i> Aadhaar Number
                                        </label>
                                        <input type="text" id="aadhar" name="aadhar" class="form-input"
                                            placeholder="Enter 12-digit Aadhaar" maxlength="12" />
                                    </div>
                                    <div class="form-group">
                                        <label for="marital_status" class="form-label">
                                            <i class="fas fa-ring"></i> Marital Status
                                        </label>
                                        <select id="marital_status" name="marital_status" class="form-input">
                                            <option value="">Select</option>
                                            <option value="single">Single</option>
                                            <option value="married">Married</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="gender" class="form-label">
                                            <i class="fas fa-venus-mars"></i> Gender
                                        </label>
                                        <select id="gender" name="gender" class="form-input">
                                            <option value="">Select Gender</option>
                                            <option value="male">Male</option>
                                            <option value="female">Female</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>

                                </div>

                                <div style="display: flex; gap: var(--space-4); margin-top: var(--space-6);">
                                    <button type="submit" name="update_contact" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Update Info
                                    </button>
                                    <button type="reset" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i>
                                        Reset Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Work Experience Section -->
            <div style="margin-top: var(--space-8);">
                <div class="card">
                    <div class="card-header">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-address-book"></i>
                            Work Experience
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="max-width: 800px;">
                            <form action="" method="post" class="details-change-form">
                                <div class="grid grid-cols-3 gap-3">
                                    <div class="form-group">
                                        <label for="company" class="form-label">
                                            <i class="fas fa-briefcase"></i> Company
                                        </label>
                                        <input type="text" id="company" name="company" class="form-input"
                                            placeholder="Enter Experience" value="" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="PAN" class="form-label">
                                            <i class="fas fa-clock"></i> Duration
                                        </label>
                                        <input type="text" id="PAN" name="PAN" class="form-input"
                                            placeholder="Enter PAN" value="" />
                                    </div>
                                </div>

                                <div style="display: flex; gap: var(--space-4); margin-top: var(--space-6);">
                                    <button type="submit" name="update_contact" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Update Info
                                    </button>
                                    <button type="reset" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i>
                                        Reset Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Academic Section -->
            <!-- <div style="margin-top: var(--space-8);">
                <div class="card">
                    <div class="card-header">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-graduation-cap"></i>
                            Academic Details
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="max-width: 800px;">
                            <form action="" method="post" class="details-change-form">
                                <div class="grid grid-cols-3 gap-3">
                                    <div class="form-group">
                                        <label for="phone" class="form-label">
                                            <i class="fas fa-phone"></i> Phone Number
                                        </label>
                                        <input type="tel" id="phone" name="phone" class="form-input"
                                            placeholder="Enter phone number" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name" class="form-label">
                                            <i class="fas fa-city"></i> City
                                        </label>
                                        <input type="text" id="last_name" name="last_name" class="form-input"
                                            placeholder="Enter Nationality" value="" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="bdate" class="form-label">
                                            <i class="fas fa-map-marker-alt"></i> ZIP
                                        </label>
                                        <input type="zip" class="form-input" placeholder="Enter Area ZIP Code"
                                            name="zip" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name" class="form-label">
                                            <i class="fas fa-map-marker-alt"></i> Country
                                        </label>
                                        <input type="text" id="last_name" name="last_name" class="form-input"
                                            placeholder="Enter Nationality" value="" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="PAN" class="form-label">
                                            <i class="fas fa-circle-user"></i> PAN
                                        </label>
                                        <input type="alphanumeric" id="PAN" name="PAN" class="form-input"
                                            placeholder="Enter PAN" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="State/UT" class="form-label">
                                            <i class="fas fa-parliament"></i> State/UT
                                        </label>
                                        <input type="dropdown" id="stateut" name="stateut" class="form-input"
                                            placeholder="Select State/UT" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="PAN" class="form-label">
                                            <i class="fas fa-circle-user"></i> PAN
                                        </label>
                                        <input type="alphanumeric" id="PAN" name="PAN" class="form-input"
                                            placeholder="Enter PAN" value="" />
                                    </div>

                                </div>

                                <div style="display: flex; gap: var(--space-4); margin-top: var(--space-6);">
                                    <button type="submit" name="update_contact" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Update Info
                                    </button>
                                    <button type="reset" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i>
                                        Reset Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div> -->

            <!-- SKills Section -->
            <!-- <div style="margin-top: var(--space-8);">
                <div class="card">
                    <div class="card-header">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-address-book"></i>
                            Skills
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="max-width: 800px;">
                            <form action="" method="post" class="details-change-form">
                                <div class="grid grid-cols-3 gap-3">
                                    <div class="form-group">
                                        <label for="phone" class="form-label">
                                            <i class="fas fa-phone"></i> Phone Number
                                        </label>
                                        <input type="tel" id="phone" name="phone" class="form-input"
                                            placeholder="Enter phone number" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name" class="form-label">
                                            <i class="fas fa-city"></i> City
                                        </label>
                                        <input type="text" id="last_name" name="last_name" class="form-input"
                                            placeholder="Enter Nationality" value="" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="bdate" class="form-label">
                                            <i class="fas fa-map-marker-alt"></i> ZIP
                                        </label>
                                        <input type="zip" class="form-input" placeholder="Enter Area ZIP Code"
                                            name="zip" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name" class="form-label">
                                            <i class="fas fa-map-marker-alt"></i> Country
                                        </label>
                                        <input type="text" id="last_name" name="last_name" class="form-input"
                                            placeholder="Enter Nationality" value="" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="PAN" class="form-label">
                                            <i class="fas fa-circle-user"></i> PAN
                                        </label>
                                        <input type="alphanumeric" id="PAN" name="PAN" class="form-input"
                                            placeholder="Enter PAN" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="State/UT" class="form-label">
                                            <i class="fas fa-parliament"></i> State/UT
                                        </label>
                                        <input type="dropdown" id="stateut" name="stateut" class="form-input"
                                            placeholder="Select State/UT" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="PAN" class="form-label">
                                            <i class="fas fa-circle-user"></i> PAN
                                        </label>
                                        <input type="alphanumeric" id="PAN" name="PAN" class="form-input"
                                            placeholder="Enter PAN" value="" />
                                    </div>

                                </div>

                                <div style="display: flex; gap: var(--space-4); margin-top: var(--space-6);">
                                    <button type="submit" name="update_contact" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Update Info
                                    </button>
                                    <button type="reset" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i>
                                        Reset Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div> -->

            <!-- Certifications Section -->
            <div style="margin-top:T var(--space-8);">
                <div class="card">
                    <div class="card-header">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-award"></i>
                            Certifications
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="max-width: 800px;">
                            <form action="" method="post" class="details-change-form">
                                <div class="grid grid-cols-3 gap-3">
                                    <!-- <p style="color: red;">Test Render</p> -->
                                    <div class="form-group">
                                        <label for="cert_name" class="form-label">
                                            <i class="fas fa-certificate"></i> Certification Name
                                        </label>
                                        <input type="text" id="cert_name" name="cert_name" class="form-input"
                                            placeholder="e.g., AWS Certified Developer" />
                                    </div>

                                    <div class="form-group">
                                        <label for="issuer" class="form-label">
                                            <i class="fas fa-building"></i> Issued By
                                        </label>
                                        <input type="text" id="issuer" name="issuer" class="form-input"
                                            placeholder="e.g., Amazon Web Services" />
                                    </div>

                                    <div class="form-group">
                                        <label for="issue_date" class="form-label">
                                            <i class="fas fa-calendar-check"></i> Issue Date
                                        </label>
                                        <input type="date" id="issue_date" name="issue_date" class="form-input" />
                                    </div>

                                    <div class="form-group">
                                        <label for="expiry_date" class="form-label">
                                            <i class="fas fa-calendar-times"></i> Expiry Date
                                        </label>
                                        <input type="date" id="expiry_date" name="expiry_date" class="form-input" />
                                    </div>

                                    <div class="form-group">
                                        <label for="cert_id" class="form-label">
                                            <i class="fas fa-hashtag"></i> Certificate ID
                                        </label>
                                        <input type="text" id="cert_id" name="cert_id" class="form-input"
                                            placeholder="Enter Certificate ID" />
                                    </div>

                                    <div class="form-group">
                                        <label for="cert_url" class="form-label">
                                            <i class="fas fa-link"></i> Certificate URL
                                        </label>
                                        <input type="url" id="cert_url" name="cert_url" class="form-input"
                                            placeholder="Paste certificate link" />
                                    </div>
                                </div>

                                <div style="display: flex; gap: var(--space-4); margin-top: var(--space-6);">
                                    <button type="submit" name="update_contact" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Update Info
                                    </button>
                                    <button type="reset" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i>
                                        Reset Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interests Section -->
            <div style="margin-top: var(--space-8);">
                <div class="card">
                    <div class="card-header">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-addresk"></i>
                            Interests & Hobbies
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="max-width: 800px;">
                            <form action="" method="post" class="details-change-form">
                                <div class="grid grid-cols-3 gap-3">
                                    <div class="form-group">
                                        <label for="phone" class="form-label">
                                            <i class="fas fa-phone"></i> Phone Number
                                        </label>
                                        <input type="tel" id="phone" name="phone" class="form-input"
                                            placeholder="Enter phone number" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name" class="form-label">
                                            <i class="fas fa-city"></i> City
                                        </label>
                                        <input type="text" id="last_name" name="last_name" class="form-input"
                                            placeholder="Enter Nationality" value="" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="bdate" class="form-label">
                                            <i class="fas fa-map-marker-alt"></i> ZIP
                                        </label>
                                        <input type="zip" class="form-input" placeholder="Enter Area ZIP Code"
                                            name="zip" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name" class="form-label">
                                            <i class="fas fa-map-marker-alt"></i> Country
                                        </label>
                                        <input type="text" id="last_name" name="last_name" class="form-input"
                                            placeholder="Enter Nationality" value="" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="PAN" class="form-label">
                                            <i class="fas fa-circle-user"></i> PAN
                                        </label>
                                        <input type="alphanumeric" id="PAN" name="PAN" class="form-input"
                                            placeholder="Enter PAN" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="State/UT" class="form-label">
                                            <i class="fas fa-parliament"></i> State/UT
                                        </label>
                                        <input type="dropdown" id="stateut" name="stateut" class="form-input"
                                            placeholder="Select State/UT" value="" />
                                    </div>
                                    <div class="form-group">
                                        <label for="PAN" class="form-label">
                                            <i class="fas fa-circle-user"></i> PAN
                                        </label>
                                        <input type="alphanumeric" id="PAN" name="PAN" class="form-input"
                                            placeholder="Enter PAN" value="" />
                                    </div>

                                </div>

                                <div style="display: flex; gap: var(--space-4); margin-top: var(--space-6);">
                                    <button type="submit" name="update_contact" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Update Info
                                    </button>
                                    <button type="reset" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i>
                                        Reset Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Password Change Section -->
            <div style="margin-top: var(--space-8);" id="change-password">
                <div class="card">
                    <div class="card-header">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-lock"></i>
                            Change Password
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="max-width: 800px;">
                            <?php
                            require_once 'includes/config.php';
                            //@ Update Password Functionality
                            $error_message = '';
                            $password_change_success = false;

                            if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['change_password'])) {
                                $current_password = $_POST['current_password'] ?? '';
                                $new_password = $_POST['new_password'] ?? '';
                                $confirm_password = $_POST['confirm_password'] ?? '';

                                $stmt = $conn->prepare("SELECT password FROM employee WHERE id = :id");
                                $stmt->bindParam(':id', $_SESSION['eid']);
                                $stmt->execute();
                                $db_current_password = $stmt->fetchColumn();

                                if (!password_verify($current_password, $db_current_password)) {
                                    $error_message = "Current password is incorrect. Contact your administrator.";
                                    // echo "5";
                                } elseif (strlen($new_password) < 6) {
                                    $error_message = "New password must be at least 6 characters long.";
                                    // echo "6";
                                } elseif ($new_password === $current_password) {
                                    $error_message = "New password cannot be the same as the current password.";
                                    // echo "7";
                                } elseif ($new_password !== $confirm_password) {
                                    // echo "8";
                                    $error_message = "New password and confirm password do not match.";
                                } else {
                                    $hashed_new_password = password_hash($new_password, PASSWORD_DEFAULT);
                                    $update = $conn->prepare("UPDATE employee SET password = :new_password WHERE id = :id");
                                    $update->bindParam(':new_password', $hashed_new_password);
                                    $update->bindParam(':id', $_SESSION['eid']);
                                    if ($update->execute()) {
                                        // echo "1";
                                        $password_change_success = true;
                                    } else {
                                        // echo "2";
                                        $error_message = 'Failed to change password. Please try again later.';
                                    }
                                    // header("Location: profile.php#change-password");
                            
                                }
                                ?>

                                <script>window.location.hash = "#change-password";</script>
                                <?php
                            }
                            ?>
                            <!-- PHP: Add your password change success/error message here -->
                            <?php if (!empty($error_message)): ?>
                                <div class="alert alert-error">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <?= htmlspecialchars($error_message); ?>
                                </div>
                            <?php elseif ($password_change_success): ?>
                                <p class="alert alert-success">
                                    <i class="fas fa-check-circle"></i> Password changed successfully.
                                </p>
                            <?php endif; ?>

                            <form action="<?php echo htmlspecialchars($_SERVER['PHP_SELF']); ?>" method="post"
                                class="password-form">
                                <div class="form-group">
                                    <label for="current_password" class="form-label">
                                        <i class="fas fa-key"></i> Current Password
                                    </label>
                                    <input type="password" id="current_password" name="current_password"
                                        class="form-input" placeholder="Enter your current password" required />
                                </div>

                                <div class="grid grid-cols-2 gap-6">
                                    <div class="form-group">
                                        <label for="new_password" class="form-label">
                                            <i class="fas fa-lock"></i> New Password
                                        </label>
                                        <input type="password" id="new_password" name="new_password" class="form-input"
                                            placeholder="Enter new password" required />
                                    </div>

                                    <div class="form-group">
                                        <label for="confirm_password" class="form-label">
                                            <i class="fas fa-lock"></i> Confirm New Password
                                        </label>
                                        <input type="password" id="confirm_password" name="confirm_password"
                                            class="form-input" placeholder="Confirm new password" required />
                                    </div>
                                </div>

                                <div style="margin-top: var(--space-6);">
                                    <button type="submit" name="change_password" class="btn btn-primary">
                                        <i class="fas fa-shield-alt"></i>
                                        Change Password
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <?php if (!empty($popupMessage))
        echo $popupMessage; ?>
    <?php include 'includes/footer.php'; ?>

    <script>
        // Function to show popup alerts
        setTimeout(() => {
            const popup = document.querySelector('.popup-alert');
            if (popup) {
                popup.style.transition = "opacity 0.5s ease";
                popup.style.opacity = 0;
                setTimeout(() => popup.remove(), 500);
            }
        }, 3000); // 3 seconds

        // Auto-hide alerts after 10 seconds
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.style.opacity = '0';
                alert.style.transition = 'opacity 0.5s ease';
                setTimeout(() => alert.remove(), 500);
            });
        }, 10000);


        function contactSupport() {
            alert('Contact support functionality would be implemented here');
        }

        // Auto-hide alerts after 5 seconds
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.style.opacity = '0';
                alert.style.transition = 'opacity 0.5s ease';
                setTimeout(() => alert.remove(), 500);
            });
        }, 5000);

        // Reset form confirmation
        document.querySelector('button[type="reset"]')?.addEventListener('click', function (e) {
            if (!confirm('Are you sure you want to reset all changes?')) {
                e.preventDefault();
            }
        });
    </script>
</body>

</html>
<!-- 
//@ To-Do

//@ Starting session functionality to be only added into the navbar
//@ Each and every detail updation has to be done and to be done via session 
//@ Password updation is a different functionality so update it separately


-->